<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>C Programming, Part 3: Common Gotchas - UIUC CS241 SystemProgramming Wiki</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "C Programming, Part 3: Common Gotchas";
    var mkdocs_page_input_path = "SystemProgramming/C-Programming,-Part-3:-Common-Gotchas.md";
    var mkdocs_page_url = "/SystemProgramming/C-Programming,-Part-3:-Common-Gotchas/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> UIUC CS241 SystemProgramming Wiki</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>SystemProgramming</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../#Example Markdown/">#Example Markdown</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../#Informal-Glossary/">#Informal Glossary</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../#Piazza: When And How to Ask For Help/">#Piazza: When And How to Ask For Help</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-1:-Introduction/">C Programming, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-2:-Text-Input-And-Output/">C Programming, Part 2: Text Input And Output</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">C Programming, Part 3: Common Gotchas</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#memory-mistakes">Memory mistakes</a></li>
                
                    <li><a class="toctree-l4" href="#string-constants-are-constant">String constants are constant</a></li>
                
                    <li><a class="toctree-l4" href="#buffer-overflow-underflow">Buffer overflow/ underflow</a></li>
                
                    <li><a class="toctree-l4" href="#returning-pointers-to-automatic-variables">Returning pointers to automatic variables</a></li>
                
                    <li><a class="toctree-l4" href="#insufficient-memory-allocation">Insufficient memory allocation</a></li>
                
                    <li><a class="toctree-l4" href="#using-uninitialized-variables">Using uninitialized variables</a></li>
                
                    <li><a class="toctree-l4" href="#assuming-uninitialized-memory-will-be-zeroed">Assuming Uninitialized memory will be zeroed</a></li>
                
                    <li><a class="toctree-l4" href="#double-free">Double-free</a></li>
                
                    <li><a class="toctree-l4" href="#dangling-pointers">Dangling pointers</a></li>
                
            
                <li class="toctree-l3"><a href="#logic-and-program-flow-mistakes">Logic and Program flow mistakes</a></li>
                
                    <li><a class="toctree-l4" href="#forgetting-break">Forgetting break</a></li>
                
                    <li><a class="toctree-l4" href="#equal-vs-equality">Equal vs. equality</a></li>
                
                    <li><a class="toctree-l4" href="#undeclared-or-incorrectly-prototyped-functions">Undeclared or incorrectly prototyped functions</a></li>
                
                    <li><a class="toctree-l4" href="#extra-semicolons">Extra Semicolons</a></li>
                
            
                <li class="toctree-l3"><a href="#other-gotchas">Other Gotchas</a></li>
                
                    <li><a class="toctree-l4" href="#preprocessor">Preprocessor</a></li>
                
                    <li><a class="toctree-l4" href="#c-preprocessor-macros-and-side-effects">C Preprocessor macros and side-effects</a></li>
                
                    <li><a class="toctree-l4" href="#c-preprocessor-macros-and-precedence">C Preprocessor macros and precedence</a></li>
                
                    <li><a class="toctree-l4" href="#c-preprocessor-logical-gotcha">C Preprocessor logical gotcha</a></li>
                
                    <li><a class="toctree-l4" href="#does-sizeof-do-anything">Does sizeof do anything?</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-4:-Strings-and-Structs/">C Programming, Part 4: Strings and Structs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-5:-Debugging/">C Programming, Part 5: Debugging</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Review-Questions/">C Programming, Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming:-Review-Questions/">C Programming: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Deadlock,-Part-1:-Resource-Allocation-Graph/">Deadlock, Part 1: Resource Allocation Graph</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Deadlock,-Part-2:-Deadlock-Conditions/">Deadlock, Part 2: Deadlock Conditions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Deadlock,-Part-3:-Dining-Philosophers/">Deadlock, Part 3: Dining Philosophers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Deadlock-Review-Questions/">Deadlock Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Exam-Topics/">Exam Topics</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-1:-Introduction/">File System, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-2:-Files-are-inodes-(everything-else-is-just-data...)/">File System, Part 2: Files are inodes (everything else is just data...)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-3:-Permissions/">File System, Part 3: Permissions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-4:-Working-with-directories/">File System, Part 4: Working with directories</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-5:-Virtual-file-systems/">File System, Part 5: Virtual file systems</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-6:-Memory-mapped-files-and-Shared-memory/">File System, Part 6: Memory mapped files and Shared memory</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-7:-Scalable-and-Reliable-Filesystems/">File System, Part 7: Scalable and Reliable Filesystems</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-8:-Removing-preinstalled-malware-from-an-Android-device/">File System, Part 8: Removing preinstalled malware from an Android device</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-9:-Disk-blocks-example/">File System, Part 9: Disk blocks example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-Systems-Review-Questions/">File Systems Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Files,-Part-1:-Working-with-files/">Files, Part 1: Working with files</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Filesystem:-Review-Questions/">Filesystem: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Forking,-Part-1:-Introduction/">Forking, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Forking,-Part-2:-Fork,-Exec,-Wait/">Forking, Part 2: Fork, Exec, Wait</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../HW0/">HW0</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Home/">Home</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../IPC-Review-Questions/">IPC Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory,-Part-1:-Heap-Memory-Introduction/">Memory, Part 1: Heap Memory Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory,-Part-2:-Implementing-a-Memory-Allocator/">Memory, Part 2: Implementing a Memory Allocator</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory,-Part-3:-Smashing-the-Stack-Example/">Memory, Part 3: Smashing the Stack Example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory-Review-Questions/">Memory Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory:-Review-Questions/">Memory: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Multi-threaded-Programming:-Review-Questions/">Multi threaded Programming: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-1:-Introduction/">Networking, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-2:-Using-getaddrinfo/">Networking, Part 2: Using getaddrinfo</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-3:-Building-a-simple-TCP-Client/">Networking, Part 3: Building a simple TCP Client</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-4:-Building-a-simple-TCP-Server/">Networking, Part 4: Building a simple TCP Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-5:-Shutting-down-ports,-reusing-ports-and-other-tricks/">Networking, Part 5: Shutting down ports, reusing ports and other tricks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-6:-Building-a-web-server/">Networking, Part 6: Building a web server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-6:-Creating-a-UDP-server/">Networking, Part 6: Creating a UDP server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-7:-Nonblocking-I-O,-select(),-and-epoll/">Networking, Part 7: Nonblocking I O, select(), and epoll</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking-Review-Questions/">Networking Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking:-Review-Questions/">Networking: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../OSI-Model/">OSI Model</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../POSIX,-Part-1:-Error-handling/">POSIX, Part 1: Error handling</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pipe:-Review-Questions/">Pipe: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pipes,-Part-1:-Introduction-to-pipes/">Pipes, Part 1: Introduction to pipes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pipes,-Part-2:-Pipe-programming-secrets/">Pipes, Part 2: Pipe programming secrets</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Process-Control,-Part-1:-Wait-macros,-using-signals/">Process Control, Part 1: Wait macros, using signals</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Processes,-Part-1:-Introduction/">Processes, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Processes-Review-Questions/">Processes Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Programming-Tricks,-Part-1/">Programming Tricks, Part 1</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pthread-Review-Questions/">Pthread Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pthreads,-Part-1:-Introduction/">Pthreads, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pthreads,-Part-2:-Usage-in-Practice/">Pthreads, Part 2: Usage in Practice</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pthreads,-Part-3:-Parallel-Problems-(Bonus)/">Pthreads, Part 3: Parallel Problems (Bonus)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../RPC,-Part-1:-Introduction-to-Remote-Procedure-Calls/">RPC, Part 1: Introduction to Remote Procedure Calls</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Sample-program-using-pthread-barriers/">Sample program using pthread barriers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Scheduling,-Part-1:-Scheduling-Processes/">Scheduling, Part 1: Scheduling Processes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Scheduling,-Part-2:-Scheduling-Processes:-Algorithms/">Scheduling, Part 2: Scheduling Processes: Algorithms</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals,-Part-2:-Pending-Signals-and-Signal-Masks/">Signals, Part 2: Pending Signals and Signal Masks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals,-Part-3:-Raising-signals/">Signals, Part 3: Raising signals</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals,-Part-4:-Sigaction/">Signals, Part 4: Sigaction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals-Review-Questions/">Signals Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals:-Review-Questions/">Signals: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-1:-Mutex-Locks/">Synchronization, Part 1: Mutex Locks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-2:-Counting-Semaphores/">Synchronization, Part 2: Counting Semaphores</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-3:-Working-with-Mutexes-And-Semaphores/">Synchronization, Part 3: Working with Mutexes And Semaphores</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-4:-The-Critical-Section-Problem/">Synchronization, Part 4: The Critical Section Problem</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-5:-Condition-Variables/">Synchronization, Part 5: Condition Variables</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-6:-Implementing-a-barrier/">Synchronization, Part 6: Implementing a barrier</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-7:-The-Reader-Writer-Problem/">Synchronization, Part 7: The Reader Writer Problem</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-8:-Ring-Buffer-Example/">Synchronization, Part 8: Ring Buffer Example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization-Concepts:-Review-Questions/">Synchronization Concepts: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization-Review-Questions/">Synchronization Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../System-Programming-Jokes/">System Programming Jokes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../System-Programming-Short-Stories-and-Songs/">System Programming Short Stories and Songs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Test-page/">Test page</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Virtual-Memory,-Part-1:-Introduction-to-Virtual-Memory/">Virtual Memory, Part 1: Introduction to Virtual Memory</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../_Footer/"> Footer</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">UIUC CS241 SystemProgramming Wiki</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>SystemProgramming &raquo;</li>
        
      
    
    <li>C Programming, Part 3: Common Gotchas</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>What common mistakes do C programmers make?</p>
<h1 id="memory-mistakes">Memory mistakes</h1>
<h2 id="string-constants-are-constant">String constants are constant</h2>
<pre><code class="C">char array[] = &quot;Hi!&quot;; // array contains a mutable copy 
strcpy(array, &quot;OK&quot;);

char *ptr = &quot;Can't change me&quot;; // ptr points to some immutable memory
strcpy(ptr, &quot;Will not work&quot;);
</code></pre>

<p>String literals are character arrays stored in the code segment of the program, which is immutable. Two string literals may share the same space in memory. An example follows:</p>
<pre><code class="C">char * str1 = &quot;Brandon Chong is the best TA&quot;;
char * str2 = &quot;Brandon Chong is the best TA&quot;;
</code></pre>

<p>The strings pointed to by <code>str1</code> and <code>str2</code> may actually reside in the same location in memory.</p>
<p>Char arrays, however, contain the literal value which has been copied from the code segment into either the stack or static memory. These following char arrays do not reside in the same place in memory.</p>
<pre><code class="C">char arr1[] = &quot;Brandon Chong didn't write this&quot;;
char arr2[] = &quot;Brandon Chong didn't write this&quot;;
</code></pre>

<h2 id="buffer-overflow-underflow">Buffer overflow/ underflow</h2>
<pre><code class="C">#define N (10)
int i = N, array[N];
for( ; i &gt;= 0; i--) array[i] = i;
</code></pre>

<p>C does not check that pointers are valid. The above example writes into <code>array[10]</code> which is outside the array bounds. This can cause memory corruption because that memory location is probably being used for something else.
In practice, this can be harder to spot because the overflow/underflow may occur in a library call e.g.</p>
<pre><code class="C">gets(array); // Let's hope the input is shorter than my array!
</code></pre>

<h2 id="returning-pointers-to-automatic-variables">Returning pointers to automatic variables</h2>
<pre><code class="C">int *f() {
    int result = 42;
    static int imok;
    return &amp;imok; // OK - static variables are not on the stack
    return &amp;result; // Not OK
}
</code></pre>

<p>Automatic variables are bound to stack memory only for the lifetime of the function.
After the function returns it is an error to continue to use the memory.</p>
<h2 id="insufficient-memory-allocation">Insufficient memory allocation</h2>
<pre><code class="C">struct User {
   char name[100];
};
typedef struct User user_t;

user_t *user = (user_t *) malloc(sizeof(user));
</code></pre>

<p>In the above example, we needed to allocate enough bytes for the struct. Instead we allocated enough bytes to hold a pointer. Once we start using the user pointer we will corrupt memory. Correct code is shown below.</p>
<pre><code class="C">struct User {
   char name[100];
};
typedef struct User user_t;

user_t * user = (user_t *) malloc(sizeof(user_t));
</code></pre>

<h4 id="strings-require-strlens1-bytes">Strings require <code>strlen(s)+1</code> bytes</h4>
<p>Every string must have a null byte after the last characters. To store the string <code>"Hi"</code> it takes 3 bytes: <code>[H] [i] [\0]</code>.</p>
<pre><code class="C">  char *strdup(const char *input) {  /* return a copy of 'input' */
    char *copy;
    copy = malloc(sizeof(char*));     /* nope! this allocates space for a pointer, not a string */
    copy = malloc(strlen(input));     /* Almost...but what about the null terminator? */
    copy = malloc(strlen(input) + 1); /* That's right. */
    strcpy(copy, input);   /* strcpy will provide the null terminator */
    return copy;
}
</code></pre>

<h2 id="using-uninitialized-variables">Using uninitialized variables</h2>
<pre><code class="C">int myfunction() {
  int x;
  int y = x + 2;
...
</code></pre>

<p>Automatic variables hold garbage (whatever bit pattern happened to be in memory). It is an error to assume that it will always be initialized to zero.</p>
<h2 id="assuming-uninitialized-memory-will-be-zeroed">Assuming Uninitialized memory will be zeroed</h2>
<pre><code class="C">void myfunct() {
   char array[10];
   char *p = malloc(10);
</code></pre>

<p>Automatic (temporary variables) are not automatically initialized to zero.
Heap allocations using malloc are not automatically initialized to zero.</p>
<h2 id="double-free">Double-free</h2>
<pre><code class="C">  char *p = malloc(10);
  free(p);
//  .. later ...
  free(p); 
</code></pre>

<p>It is an error to free the same block of memory twice.</p>
<h2 id="dangling-pointers">Dangling pointers</h2>
<pre><code class="C">  char *p = malloc(10);
  strcpy(p, &quot;Hello&quot;);
  free(p);
//  .. later ...
  strcpy(p,&quot;World&quot;); 
</code></pre>

<p>Pointers to freed memory should not be used. A defensive programming practice is to set pointers to null as soon as the memory is freed.</p>
<p>It is a good idea to turn free into the following snippet that automatically sets the freed variable to null right after:(vim - ultisnips)  </p>
<pre><code class="Vim">snippet free &quot;free(something)&quot; b
free(${1});
$1 = NULL;
${2}
endsnippet
</code></pre>

<h1 id="logic-and-program-flow-mistakes">Logic and Program flow mistakes</h1>
<h2 id="forgetting-break">Forgetting break</h2>
<pre><code class="C">int flag = 1; // Will print all three lines.
switch(flag) {
  case 1: printf(&quot;I'm printed\n&quot;);
  case 2: printf(&quot;Me too\n&quot;);
  case 3: printf(&quot;Me three\n&quot;);
}
</code></pre>

<p>Case statements without a break will just continue onto the code of the next case statement. Correct code is show below. The break for the last statements is unnecessary because there are no more cases to be executed after the last one. However if more are added, it can cause some bugs.</p>
<pre><code class="C">int flag = 1; // Will print only &quot;I'm printed\n&quot;
switch(flag) {
  case 1: 
    printf(&quot;I'm printed\n&quot;);
    break;
  case 2: 
    printf(&quot;Me too\n&quot;);
    break;
  case 3: 
    printf(&quot;Me three\n&quot;);
    break; //unnecessary
}
</code></pre>

<h2 id="equal-vs-equality">Equal vs. equality</h2>
<pre><code class="C">int answer = 3; // Will print out the answer.
if (answer = 42) { printf(&quot;I've solved the answer! It's %d&quot;, answer);}
</code></pre>

<h2 id="undeclared-or-incorrectly-prototyped-functions">Undeclared or incorrectly prototyped functions</h2>
<pre><code class="C">time_t start = time();
</code></pre>

<p>The system function 'time' actually takes a parameter (a pointer to some memory that can receive the time_t structure). The compiler did not catch this error because the programmer did not provide a valid function prototype by including <code>time.h</code></p>
<h2 id="extra-semicolons">Extra Semicolons</h2>
<pre><code class="C">for(int i = 0; i &lt; 5; i++) ; printf(&quot;I'm printed once&quot;);
while(x &lt; 10); x++ ; // X is never incremented
</code></pre>

<p>However, the following code is perfectly OK.</p>
<pre><code class="C">for(int i = 0; i &lt; 5; i++){
    printf(&quot;%d\n&quot;, i);;;;;;;;;;;;;
}
</code></pre>

<p>It is OK to have this kind of code, because the C language uses semicolons (;) to separate statements. If there is no statement in between semicolons, then there is nothing to do and the compiler moves on to the next statement</p>
<h1 id="other-gotchas">Other Gotchas</h1>
<h2 id="preprocessor">Preprocessor</h2>
<p>What is the preprocessor? It is an operation that the compiler performs <strong>before</strong> actually compiling the program. It is a copy and paste command. Meaning that if I do the following.</p>
<pre><code class="C">#define MAX_LENGTH 10
char buffer[MAX_LENGTH]
</code></pre>

<p>After preprocessing, it'll look like this.</p>
<pre><code class="C">char buffer[10]
</code></pre>

<h2 id="c-preprocessor-macros-and-side-effects">C Preprocessor macros and side-effects</h2>
<pre><code class="C">#define min(a,b) ((a)&lt;(b) ? (a) : (b))
int x = 4;
if(min(x++, 100)) printf(&quot;%d is six&quot;, x);
</code></pre>

<p>Macros are simple text substitution so the above example expands to <code>x++ &lt; 100 ? x++ : 100</code> (parenthesis omitted for clarity)</p>
<h2 id="c-preprocessor-macros-and-precedence">C Preprocessor macros and precedence</h2>
<pre><code class="C">#define min(a,b) a&lt;b ? a : b
int x = 99;
int r = 10 + min(99, 100); // r is 100!
</code></pre>

<p>Macros are simple text substitution so the above example expands to <code>10 + 99 &lt; 100 ? 99 : 100</code></p>
<h2 id="c-preprocessor-logical-gotcha">C Preprocessor logical gotcha</h2>
<pre><code class="C">#define ARRAY_LENGTH(A) (sizeof((A)) / sizeof((A)[0]))
int static_array[10]; // ARRAY_LENGTH(static_array) = 10
int* dynamic_array = malloc(10); // ARRAY_LENGTH(dynamic_array) = 2 or 1
</code></pre>

<p>What is wrong with the macro? Well it works if we have a static array like the first array because sizeof a static array returns the bytes that array takes up, and dividing it by the sizeof(an_element) would give you the number of entries. But if we use a pointer to a piece of memory, taking the sizeof the pointer and dividing it by the size of the first entry won't always give us the size of the array.</p>
<h2 id="does-sizeof-do-anything">Does <code>sizeof</code> do anything?</h2>
<pre><code class="C">int a = 0;
size_t size = sizeof(a++);
printf(&quot;size: %lu, a: %d&quot;, size, a);
</code></pre>

<p>What does the code print out?</p>
<pre><code>size: 4, a: 0
</code></pre>

<p>Because sizeof is not actually evaluated at runtime. The compiler assigns the type of all expressions and discards the extra results of the expression.</p>
<div align="center">
<a href="https://github.com/angrave/SystemProgramming/wiki/C-Programming,-Part-2:-Text-Input-And-Output">
Back: C Programming, Part 2: Text Input And Output
</a> |
<a href="https://github.com/angrave/SystemProgramming/wiki/C-Programming%2C-Part-4%3A-Strings-and-Structs">
Next: C Programming, Part 4: Strings and Structs
</a>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../C-Programming,-Part-4:-Strings-and-Structs/" class="btn btn-neutral float-right" title="C Programming, Part 4: Strings and Structs">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../C-Programming,-Part-2:-Text-Input-And-Output/" class="btn btn-neutral" title="C Programming, Part 2: Text Input And Output"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../C-Programming,-Part-2:-Text-Input-And-Output/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../C-Programming,-Part-4:-Strings-and-Structs/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
