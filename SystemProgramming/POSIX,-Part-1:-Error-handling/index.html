<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>POSIX, Part 1: Error handling - UIUC CS241 SystemProgramming Wiki</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "POSIX, Part 1: Error handling";
    var mkdocs_page_input_path = "SystemProgramming/POSIX,-Part-1:-Error-handling.md";
    var mkdocs_page_url = "/SystemProgramming/POSIX,-Part-1:-Error-handling/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> UIUC CS241 SystemProgramming Wiki</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>SystemProgramming</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../#Example Markdown/">#Example Markdown</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../#Informal-Glossary/">#Informal Glossary</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../#Piazza: When And How to Ask For Help/">#Piazza: When And How to Ask For Help</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-1:-Introduction/">C Programming, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-2:-Text-Input-And-Output/">C Programming, Part 2: Text Input And Output</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-3:-Common-Gotchas/">C Programming, Part 3: Common Gotchas</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-4:-Strings-and-Structs/">C Programming, Part 4: Strings and Structs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-5:-Debugging/">C Programming, Part 5: Debugging</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Review-Questions/">C Programming, Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming:-Review-Questions/">C Programming: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Deadlock,-Part-1:-Resource-Allocation-Graph/">Deadlock, Part 1: Resource Allocation Graph</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Deadlock,-Part-2:-Deadlock-Conditions/">Deadlock, Part 2: Deadlock Conditions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Deadlock,-Part-3:-Dining-Philosophers/">Deadlock, Part 3: Dining Philosophers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Deadlock-Review-Questions/">Deadlock Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Exam-Topics/">Exam Topics</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-1:-Introduction/">File System, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-2:-Files-are-inodes-(everything-else-is-just-data...)/">File System, Part 2: Files are inodes (everything else is just data...)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-3:-Permissions/">File System, Part 3: Permissions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-4:-Working-with-directories/">File System, Part 4: Working with directories</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-5:-Virtual-file-systems/">File System, Part 5: Virtual file systems</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-6:-Memory-mapped-files-and-Shared-memory/">File System, Part 6: Memory mapped files and Shared memory</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-7:-Scalable-and-Reliable-Filesystems/">File System, Part 7: Scalable and Reliable Filesystems</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-8:-Removing-preinstalled-malware-from-an-Android-device/">File System, Part 8: Removing preinstalled malware from an Android device</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-9:-Disk-blocks-example/">File System, Part 9: Disk blocks example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-Systems-Review-Questions/">File Systems Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Files,-Part-1:-Working-with-files/">Files, Part 1: Working with files</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Filesystem:-Review-Questions/">Filesystem: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Forking,-Part-1:-Introduction/">Forking, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Forking,-Part-2:-Fork,-Exec,-Wait/">Forking, Part 2: Fork, Exec, Wait</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../HW0/">HW0</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Home/">Home</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../IPC-Review-Questions/">IPC Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory,-Part-1:-Heap-Memory-Introduction/">Memory, Part 1: Heap Memory Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory,-Part-2:-Implementing-a-Memory-Allocator/">Memory, Part 2: Implementing a Memory Allocator</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory,-Part-3:-Smashing-the-Stack-Example/">Memory, Part 3: Smashing the Stack Example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory-Review-Questions/">Memory Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory:-Review-Questions/">Memory: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Multi-threaded-Programming:-Review-Questions/">Multi threaded Programming: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-1:-Introduction/">Networking, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-2:-Using-getaddrinfo/">Networking, Part 2: Using getaddrinfo</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-3:-Building-a-simple-TCP-Client/">Networking, Part 3: Building a simple TCP Client</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-4:-Building-a-simple-TCP-Server/">Networking, Part 4: Building a simple TCP Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-5:-Shutting-down-ports,-reusing-ports-and-other-tricks/">Networking, Part 5: Shutting down ports, reusing ports and other tricks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-6:-Building-a-web-server/">Networking, Part 6: Building a web server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-6:-Creating-a-UDP-server/">Networking, Part 6: Creating a UDP server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-7:-Nonblocking-I-O,-select(),-and-epoll/">Networking, Part 7: Nonblocking I O, select(), and epoll</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking-Review-Questions/">Networking Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking:-Review-Questions/">Networking: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../OSI-Model/">OSI Model</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">POSIX, Part 1: Error handling</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#what-is-posix-error-handling">What is POSIX error handling?</a></li>
                
                    <li><a class="toctree-l4" href="#what-is-errno-and-when-is-it-set">What is errno and when is it set?</a></li>
                
                    <li><a class="toctree-l4" href="#what-about-multiple-threads">What about multiple threads?</a></li>
                
                    <li><a class="toctree-l4" href="#when-is-errno-reset-to-zero">When is errno reset to zero?</a></li>
                
                    <li><a class="toctree-l4" href="#what-are-the-gotchas-and-best-practices-of-using-errno">What are the gotchas and best practices of using errno?</a></li>
                
                    <li><a class="toctree-l4" href="#how-can-you-print-out-the-string-message-associated-with-a-particular-error-number">How can you print out the string message associated with a particular error number?</a></li>
                
                    <li><a class="toctree-l4" href="#how-are-perror-and-strerror-related">How are perror and strerror related?</a></li>
                
                    <li><a class="toctree-l4" href="#what-are-the-gotchas-of-using-strerror">What are the gotchas of using strerror?</a></li>
                
                    <li><a class="toctree-l4" href="#what-is-eintr-what-does-it-mean-for-sem_wait-read-write">What is EINTR? What does it mean for sem_wait? read? write?</a></li>
                
                    <li><a class="toctree-l4" href="#which-system-calls-may-be-interrupted-and-need-to-be-wrapped">Which system calls may be interrupted and need to be wrapped?</a></li>
                
                    <li><a class="toctree-l4" href="#errno-exceptions">Errno exceptions?</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pipe:-Review-Questions/">Pipe: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pipes,-Part-1:-Introduction-to-pipes/">Pipes, Part 1: Introduction to pipes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pipes,-Part-2:-Pipe-programming-secrets/">Pipes, Part 2: Pipe programming secrets</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Process-Control,-Part-1:-Wait-macros,-using-signals/">Process Control, Part 1: Wait macros, using signals</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Processes,-Part-1:-Introduction/">Processes, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Processes-Review-Questions/">Processes Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Programming-Tricks,-Part-1/">Programming Tricks, Part 1</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pthread-Review-Questions/">Pthread Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pthreads,-Part-1:-Introduction/">Pthreads, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pthreads,-Part-2:-Usage-in-Practice/">Pthreads, Part 2: Usage in Practice</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pthreads,-Part-3:-Parallel-Problems-(Bonus)/">Pthreads, Part 3: Parallel Problems (Bonus)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../RPC,-Part-1:-Introduction-to-Remote-Procedure-Calls/">RPC, Part 1: Introduction to Remote Procedure Calls</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Sample-program-using-pthread-barriers/">Sample program using pthread barriers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Scheduling,-Part-1:-Scheduling-Processes/">Scheduling, Part 1: Scheduling Processes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Scheduling,-Part-2:-Scheduling-Processes:-Algorithms/">Scheduling, Part 2: Scheduling Processes: Algorithms</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals,-Part-2:-Pending-Signals-and-Signal-Masks/">Signals, Part 2: Pending Signals and Signal Masks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals,-Part-3:-Raising-signals/">Signals, Part 3: Raising signals</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals,-Part-4:-Sigaction/">Signals, Part 4: Sigaction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals-Review-Questions/">Signals Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals:-Review-Questions/">Signals: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-1:-Mutex-Locks/">Synchronization, Part 1: Mutex Locks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-2:-Counting-Semaphores/">Synchronization, Part 2: Counting Semaphores</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-3:-Working-with-Mutexes-And-Semaphores/">Synchronization, Part 3: Working with Mutexes And Semaphores</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-4:-The-Critical-Section-Problem/">Synchronization, Part 4: The Critical Section Problem</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-5:-Condition-Variables/">Synchronization, Part 5: Condition Variables</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-6:-Implementing-a-barrier/">Synchronization, Part 6: Implementing a barrier</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-7:-The-Reader-Writer-Problem/">Synchronization, Part 7: The Reader Writer Problem</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-8:-Ring-Buffer-Example/">Synchronization, Part 8: Ring Buffer Example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization-Concepts:-Review-Questions/">Synchronization Concepts: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization-Review-Questions/">Synchronization Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../System-Programming-Jokes/">System Programming Jokes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../System-Programming-Short-Stories-and-Songs/">System Programming Short Stories and Songs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Test-page/">Test page</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Virtual-Memory,-Part-1:-Introduction-to-Virtual-Memory/">Virtual Memory, Part 1: Introduction to Virtual Memory</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../_Footer/"> Footer</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">UIUC CS241 SystemProgramming Wiki</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>SystemProgramming &raquo;</li>
        
      
    
    <li>POSIX, Part 1: Error handling</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="what-is-posix-error-handling">What is POSIX error handling?</h1>
<p>In other languages, you may see error handling implemented with exceptions. Although you technically can use them in c (You keep a stack of very try/catch block and use <code>setjmp</code> and <code>longjmp</code> to go to those blocks respectively), error handling in C is typically done with posix error handling the code typically looks like this.</p>
<pre><code class="C">int ret = some_system_call()
if(ret == ERROR_CODE){
switch(errno){
// Do different stuff based on the errno number.
}
}

</code></pre>

<p>In the kernel, the use of <code>goto</code> is heavily used to clean up different parts of the application. <strong>You should not use gotos</strong> because they make code harder to read. gotos in the kernel are there out of necessity, so don't take lessons.</p>
<h2 id="what-is-errno-and-when-is-it-set">What is <code>errno</code> and when is it set?</h2>
<p>POSIX defines a special integer <code>errno</code> that is set when a system call fails.
The initial value of <code>errno</code> is zero (i.e. no error).
When a system call fails it will typically return -1 to indicate an error and set <code>errno</code></p>
<h2 id="what-about-multiple-threads">What about multiple threads?</h2>
<p>Each thread has it's own copy of <code>errno</code>. This is very useful; otherwise an error in one thread would interfere with the error status of another thread.</p>
<h2 id="when-is-errno-reset-to-zero">When is <code>errno</code> reset to zero?</h2>
<p>It's not unless you specifically reset it to zero!  When system calls are successful they do <em>not</em> reset the value of <code>errno</code>.</p>
<p>This means you should only rely on the value of errno if you know a system call has failed (e.g. it returned -1).</p>
<h2 id="what-are-the-gotchas-and-best-practices-of-using-errno">What are the gotchas and best practices of using <code>errno</code>?</h2>
<p>Be careful when complex error handling use of library calls or system calls that may change the value of <code>errno</code>. In practice it's safer to copy the value of errno into a int variable:</p>
<pre><code class="C">// Unsafe - the first fprintf may change the value of errno before we use it!
if (-1 == sem_wait(&amp;s)) {
   fprintf(stderr, &quot;An error occurred!&quot;);
   fprintf(stderr, &quot;The error value is %d\n&quot;, errno);
}
// Better, copy the value before making more system and library calls
if (-1 == sem_wait(&amp;s)) {
   int errno_saved = errno;
   fprintf(stderr, &quot;An error occurred!&quot;);
   fprintf(stderr, &quot;The error value is %d\n&quot;, errno_saved);
}
</code></pre>

<p>In a similar vein, if your signal handler makes any system or library calls, then it is good practice to save the original value of errno and restore the value before returning:</p>
<pre><code class="C">void handler(int signal) {
   int errno_saved = errno;

   // make system calls that might change errno

   errno = errno_saved;
}
</code></pre>

<h2 id="how-can-you-print-out-the-string-message-associated-with-a-particular-error-number">How can you print out the string message associated with a particular error number?</h2>
<p>Use <code>strerror</code> to get a short (English) description of the error value</p>
<pre><code class="C">char *mesg = strerror(errno);
fprintf(stderr, &quot;An error occurred (errno=%d): %s&quot;, errno, mesg);
</code></pre>

<h2 id="how-are-perror-and-strerror-related">How are perror and strerror related?</h2>
<p>In previous pages we've used perror to print out the error to standard error. Using <code>strerror</code>, we can now write a simple implementation of <code>perror</code>:</p>
<pre><code class="C">void perror(char *what) {
   fprintf(stderr, &quot;%s: %s\n&quot;, what, strerror(errno));
}
</code></pre>

<h2 id="what-are-the-gotchas-of-using-strerror">What are the gotchas of using strerror?</h2>
<p>Unfortunately <code>strerror</code> is not threadsafe. In other words, two threads cannot call it at the same time!</p>
<p>There are two workarounds: Firstly we can use a mutex lock to define a critical section and a local buffer. The same mutex should be used by all threads in all places that call <code>strerror</code></p>
<pre><code class="C">pthread_mutex_lock(&amp;m);
char *result = strerror(errno);
char *message = malloc(strlen(result) + 1);
strcpy(message, result);
pthread_mutex_unlock(&amp;m);
fprintf(stderr, &quot;An error occurred (errno=%d): %s&quot;, errno, message);
free(message);
</code></pre>

<p>Alternatively use the less portable but thread-safe <code>strerror_r</code></p>
<h2 id="what-is-eintr-what-does-it-mean-for-sem_wait-read-write">What is EINTR? What does it mean for sem_wait? read? write?</h2>
<p>Some system calls can be interrupted when a signal (e.g SIGCHLD, SIGPIPE,...) is delivered to the process. At this point the system call may return without performing any action! For example, bytes may not have been read/written, semaphore wait may not have waited.</p>
<p>This interruption can be detected by checking the return value and if <code>errno</code> is EINTR. In which case the system call should be retried. It's common to see the following kind of loop that wraps a system call (such as sem_wait).</p>
<pre><code class="C">while ((-1 == systemcall(...)) &amp;&amp; (errno == EINTR)) { /* repeat! */}
</code></pre>

<p>Be careful to write <code>== EINTR</code>, not <code>= EINTR</code>.</p>
<p>Or, if the result value needs to be used later...</p>
<pre><code class="C">while ((-1 == (result = systemcall(...))) &amp;&amp; (errno == EINTR)) { /* repeat! */}
</code></pre>

<p>On Linux,calling <code>read</code> and <code>write</code> to a local disk will normally not return with EINTR (instead the function is automatically restarted for you). However, calling <code>read</code> and <code>write</code> on a file descriptor that corresponds to a network stream <em>can</em> return with EINTR.</p>
<h2 id="which-system-calls-may-be-interrupted-and-need-to-be-wrapped">Which system calls may be interrupted and need to be wrapped?</h2>
<p>Use man the page! The man page includes a list of errors (i.e. errno values) that may be set by the system call. A rule of thumb is 'slow' (blocking) calls (e.g. writing to a socket) may be interrupted but fast non-blocking calls (e.g. pthread_mutex_lock) will not.</p>
<p>From the linux signal 7 man page.</p>
<p>"If a signal handler is invoked while a system call or library function call is blocked, then either:
<em> the call is automatically restarted after the signal handler returns; or
</em> the call fails with the error EINTR.
Which of these two behaviors occurs depends on the interface and whether or not the signal handler was established using the SA_RESTART flag (see sigaction(2)). The details vary across UNIX systems; below, the details for Linux.</p>
<p>If a blocked call to one of the following interfaces is interrupted by a signal handler, then the call will be automatically restarted after the signal handler returns if the SA_RESTART flag was used; otherwise the call will fail with the error EINTR:</p>
<ul>
<li>read(2), readv(2), write(2), writev(2), and ioctl(2) calls on "slow" devices. A "slow" device is one where the I/O call may block for an indefinite time, for example, a terminal, pipe, or socket. (A disk is not a slow device according to this definition.) If an I/O call on a slow device has already transferred some data by the time it is interrupted by a signal handler, then the call will return a success status (normally, the number of bytes transferred).
"</li>
</ul>
<p>Note, it is easy to believe that setting 'SA_RESTART' flag is sufficient to make this whole problem disappear. Unfortunately that's not true: there are still system calls that may return early and set <code>EINTR</code>! See <a href="https://cs-education.github.io/sysassets/man_pages/html/man7/signal.7.html">signal(7)</a> for details. </p>
<h2 id="errno-exceptions">Errno exceptions?</h2>
<p>There are some POSIX utilities that have their own errno per say. One is when you call <code>getaddrinfo</code> the function to check that error and convert to a string is <a href="https://linux.die.net/man/3/gai_strerror">gai_strerr</a>. Don't get them mixed up!</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Pipe:-Review-Questions/" class="btn btn-neutral float-right" title="Pipe: Review Questions">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../OSI-Model/" class="btn btn-neutral" title="OSI Model"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../OSI-Model/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Pipe:-Review-Questions/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
