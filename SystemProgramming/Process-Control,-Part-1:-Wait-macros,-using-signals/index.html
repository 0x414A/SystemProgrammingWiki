<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Process Control, Part 1: Wait macros, using signals - UIUC CS241 SystemProgramming Wiki</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Process Control, Part 1: Wait macros, using signals";
    var mkdocs_page_input_path = "SystemProgramming/Process-Control,-Part-1:-Wait-macros,-using-signals.md";
    var mkdocs_page_url = "/SystemProgramming/Process-Control,-Part-1:-Wait-macros,-using-signals/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> UIUC CS241 SystemProgramming Wiki</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>SystemProgramming</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../#Example Markdown/">#Example Markdown</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../#Informal-Glossary/">#Informal Glossary</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../#Piazza: When And How to Ask For Help/">#Piazza: When And How to Ask For Help</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C Programming, Part 4: Debugging/">C Programming, Part 4: Debugging</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-1:-Introduction/">C Programming, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-2:-Text-Input-And-Output/">C Programming, Part 2: Text Input And Output</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming,-Part-3:-Common-Gotchas/">C Programming, Part 3: Common Gotchas</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../C-Programming:-Review-Questions/">C Programming: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Deadlock,-Part-1:-Resource-Allocation-Graph/">Deadlock, Part 1: Resource Allocation Graph</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Deadlock,-Part-2:-Deadlock-Conditions/">Deadlock, Part 2: Deadlock Conditions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Exam-Topics/">Exam Topics</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-1:-Introduction/">File System, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-2:-Files-are-inodes-(everything-else-is-just-data...)/">File System, Part 2: Files are inodes (everything else is just data...)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-3:-Permissions/">File System, Part 3: Permissions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-4:-Working-with-directories/">File System, Part 4: Working with directories</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-5:-Virtual-file-systems/">File System, Part 5: Virtual file systems</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-6:-Memory-mapped-files-and-Shared-memory/">File System, Part 6: Memory mapped files and Shared memory</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-7:-Scalable-and-Reliable-Filesystems/">File System, Part 7: Scalable and Reliable Filesystems</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-8:-Disk-blocks-example/">File System, Part 8: Disk blocks example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../File-System,-Part-8:-Removing-preinstalled-malware-from-an-Android-device/">File System, Part 8: Removing preinstalled malware from an Android device</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Files,-Part-1:-Working-with-files/">Files, Part 1: Working with files</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Filesystem:-Review-Questions/">Filesystem: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Forking,-Part-1:-Introduction/">Forking, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Forking,-Part-2:-Fork,-Exec,-Wait/">Forking, Part 2: Fork, Exec, Wait</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../HW0/">HW0</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Home/">Home</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory,-Part-1:-Heap-Memory-Introduction/">Memory, Part 1: Heap Memory Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory,-Part-2:-Implementing-a-Memory-Allocator/">Memory, Part 2: Implementing a Memory Allocator</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory,-Part-3:-Smashing-the-Stack-Example/">Memory, Part 3: Smashing the Stack Example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Memory:-Review-Questions/">Memory: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Multi-threaded-Programming:-Review-Questions/">Multi threaded Programming: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking, Part 3: Building a simple TCP Client/">Networking, Part 3: Building a simple TCP Client</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking, Part 6: Creating a UDP server/">Networking, Part 6: Creating a UDP server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-1:-Introduction/">Networking, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-2:-Using-getaddrinfo/">Networking, Part 2: Using getaddrinfo</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-4:-Building-a-simple-TCP-Server/">Networking, Part 4: Building a simple TCP Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking,-Part-5:-Reusing-ports/">Networking, Part 5: Reusing ports</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Networking:-Review-Questions/">Networking: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Nonblocking-I-O,-select(),-and-epoll/">Nonblocking I O, select(), and epoll</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../OSI-Model/">OSI Model</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../POSIX,-Part-1:-Error-handling/">POSIX, Part 1: Error handling</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pipe:-Review-Questions/">Pipe: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pipes,-Part-1:-Introduction-to-pipes/">Pipes, Part 1: Introduction to pipes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pipes,-Part-2:-Pipe-programming-secrets/">Pipes, Part 2: Pipe programming secrets</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Process Control, Part 1: Wait macros, using signals</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#can-i-find-out-the-exit-value-of-my-child">Can I find out the exit value of my child?</a></li>
                
            
                <li class="toctree-l3"><a href="#can-i-pause-my-child">Can I pause my child?</a></li>
                
            
                <li class="toctree-l3"><a href="#how-do-i-killstopsuspend-my-child-from-c">How do I kill/stop/suspend my child from C?</a></li>
                
            
                <li class="toctree-l3"><a href="#how-can-i-detect-ctrl-c-and-clean-up-gracefully">How can I detect "CTRL-C" and clean up gracefully?</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Programming-Tricks,-Part-1/">Programming Tricks, Part 1</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pthreads,-Part-1:-Introduction/">Pthreads, Part 1: Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Pthreads,-Part-2:-Usage-in-Practice/">Pthreads, Part 2: Usage in Practice</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../RPC,-Part-1:-Introduction-to-Remote-Procedure-Calls/">RPC, Part 1: Introduction to Remote Procedure Calls</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Sample-program-using-pthread-barriers/">Sample program using pthread barriers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Scheduling,-Part-1:-Scheduling-Processes/">Scheduling, Part 1: Scheduling Processes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals,-Part-2:-Pending-Signals-and-Signal-Masks/">Signals, Part 2: Pending Signals and Signal Masks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals,-Part-3:-Raising-signals/">Signals, Part 3: Raising signals</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals,-Part-4:-Sigaction/">Signals, Part 4: Sigaction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Signals:-Review-Questions/">Signals: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-1:-Mutex-Locks/">Synchronization, Part 1: Mutex Locks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-2:-Counting-Semaphores/">Synchronization, Part 2: Counting Semaphores</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-3:-Working-with-Mutexes-And-Semaphores/">Synchronization, Part 3: Working with Mutexes And Semaphores</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-4:-The-Critical-Section-Problem/">Synchronization, Part 4: The Critical Section Problem</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-5:-Condition-Variables/">Synchronization, Part 5: Condition Variables</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-6:-Implementing-a-barrier/">Synchronization, Part 6: Implementing a barrier</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-7:-The-Reader-Writer-Problem/">Synchronization, Part 7: The Reader Writer Problem</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-8:-Ring-Buffer-Example/">Synchronization, Part 8: Ring Buffer Example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization,-Part-9:-The-Reader-Writer-Problem-(part-2)/">Synchronization, Part 9: The Reader Writer Problem (part 2)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Synchronization-Concepts:-Review-Questions/">Synchronization Concepts: Review Questions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../System-Programming-Short-Stories-and-Songs/">System Programming Short Stories and Songs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Test-page/">Test page</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Virtual-Memory,-Part-1:-Introduction-to-Virtual-Memory/">Virtual Memory, Part 1: Introduction to Virtual Memory</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../_Footer/"> Footer</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">UIUC CS241 SystemProgramming Wiki</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>SystemProgramming &raquo;</li>
        
      
    
    <li>Process Control, Part 1: Wait macros, using signals</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="can-i-find-out-the-exit-value-of-my-child">Can I find out the exit value of my child?</h2>
<p>You can find the lowest 8 bits of the child's exit value (the return value of <code>main()</code> or value included in <code>exit()</code>): Use the "Wait macros" - typically you will use "WIFEXITED" and "WEXITSTATUS" . See <code>wait</code>/<code>waitpid</code> man page for more information).</p>
<pre><code class="C">int status;
pid_t child = fork();
if (child == -1) return 1; //Failed
if (child &gt; 0) { /* I am the parent - wait for the child to finish */
  pid_t pid = waitpid(child, &amp;status, 0);
  if (pid != -1 &amp;&amp; WIFEXITED(status)) {
     int low8bits = WEXITSTATUS(status);
     printf(&quot;Process %d returned %d&quot; , pid, low8bits);
  }
} else { /* I am the child */
 // do something interesting
  execl(&quot;/bin/ls&quot;, &quot;/bin/ls&quot;, &quot;.&quot;, (char *) NULL); // &quot;ls .&quot;
}
</code></pre>

<h2 id="can-i-pause-my-child">Can I pause my child?</h2>
<p>Yes ! You can temporarily pause a running process by sending it a SIGSTOP signal.
If it succeeds it will freeze a process; i.e. the process will not be allocated anymore CPU time.</p>
<p>To allow a process to resume execution send it the SIGCONT signal.</p>
<p>For example,
Here's program that slowly prints a dot every second, up to 59 dots.</p>
<pre><code class="C">#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
int main() {
  printf(&quot;My pid is %d\n&quot;, getpid() );
  int i = 60;
  while(--i) { 
    write(1, &quot;.&quot;,1);
    sleep(1);
  }
  write(1, &quot;Done!&quot;,5);
  return 0;
}
</code></pre>

<p>We will first start the process in the background (notice the &amp; at the end).
Then send it a signal from the shell process by using the kill command.</p>
<pre><code>&gt;./program &amp;
My pid is 403
...
&gt;kill -SIGSTOP 403
&gt;kill -SIGCONT 403
</code></pre>

<h2 id="how-do-i-killstopsuspend-my-child-from-c">How do I kill/stop/suspend my child from C?</h2>
<p>In C, send a signal to the child using <code>kill</code> POSIX call,</p>
<pre><code class="C">kill(child, SIGUSR1); // Send a user-defined signal
kill(child, SIGSTOP); // Stop the child process (the child cannot prevent this)
kill(child, SIGTERM); // Terminate the child process (the child can prevent this)
kill(child, SIGINT); // Equivalent to CTRL-C (by default closes the process)
</code></pre>

<p>As we saw above there is also a kill command available in the shell
e.g. get a list of running processes and then terminate process 45 and process 46</p>
<pre><code>ps
kill -l 
kill -9 45
kill -s TERM 46
</code></pre>

<h2 id="how-can-i-detect-ctrl-c-and-clean-up-gracefully">How can I detect "CTRL-C" and clean up gracefully?</h2>
<p>We will return to signals later on - this is just a short introduction. On a Linux system, see <code>man -s7 signal</code> if you are interested in finding out more (for example a list of system and library calls that are async-signal-safe.</p>
<p>There are strict limitations on the executable code inside a signal handler. Most library and system calls are not 'async-signal-safe' - they may be not use used inside a signal handler because they are not re-entrant safe. In a single-threaded program, signal handling momentarily interrupts the program execution to execute the signal handler code instead. Suppose your original program was interrupted while executing the library code of <code>malloc</code> ;  the memory structures used by malloc will not be in a consistent state. Calling <code>printf</code> (which uses <code>malloc</code>) as part of the signal handler is unsafe and will result in "undefined behavior" i.e. it is no longer a useful,predictable program. In practice your program might crash, compute or generate incorrect results or stop functioning ("deadlock"), depending on exactly what your program was executing when it was interrupted to execute the signal handler code.</p>
<p>One common use of signal handlers is to set a boolean flag that is occasionally polled (read) as part of the normal running of the program. For example,</p>
<pre><code class="C">int pleaseStop ; // See notes on why &quot;volatile sig_atomic_t&quot; is better

void handle_sigint(int signal) {
  pleaseStop = 1;
}

int main() {
  signal(SIGINT, handle_sigint);
  pleaseStop = 0;
  while ( ! pleaseStop) { 
     /* application logic here */ 
   }
  /* cleanup code here */
}
</code></pre>

<p>The above code might appear to be correct on paper. However, we need to provide a hint to the compiler and to the CPU core that will execute the <code>main()</code> loop. We need to prevent a compiler optimization: The expression <code>! pleaseStop</code> appears to be a loop invariant i.e. true forever, so can be simplified to <code>true</code>.  Secondly, we need to ensure that the value of <code>pleaseStop</code> is not cached using a CPU register and instead always read from and written to main memory. The <code>sig_atomic_t</code> type implies that all the bits of the variable can be read or modified as an "atomic operation" - a single uninterruptable operation. It is impossible to read a value that is composed of some new bit values and old bit values.</p>
<p>By specifying <code>pleaseStop</code> with the correct type <code>volatile sig_atomic_t</code> we can write portable code where the main loop will be exited after the signal handler returns. The <code>sig_atomic_t</code> type can be as large as an <code>int</code> on most modern platforms but on embedded systems can be as small as a <code>char</code> and only able to represent (-127 to 127) values.</p>
<pre><code class="C">volatile sig_atomic_t pleaseStop;
</code></pre>

<p>Two examples of this pattern can be found in "COMP" a terminal based 1Hz 4bit computer (https://github.com/gto76/comp-cpp/blob/1bf9a77eaf8f57f7358a316e5bbada97f2dc8987/src/output.c#L121).
Two boolean flags are used. One to mark the delivery of <code>SIGINT</code> (CTRL-C), and gracefully shutdown the program, and the other to mark <code>SIGWINCH</code> signal to detect terminal resize and redraw the entire display. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Programming-Tricks,-Part-1/" class="btn btn-neutral float-right" title="Programming Tricks, Part 1">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Pipes,-Part-2:-Pipe-programming-secrets/" class="btn btn-neutral" title="Pipes, Part 2: Pipe programming secrets"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Pipes,-Part-2:-Pipe-programming-secrets/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Programming-Tricks,-Part-1/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
